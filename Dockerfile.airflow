FROM apache/airflow:3.1.3

USER root

RUN apt-get update && \
    apt-get install -y openjdk-17-jdk && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# No need to download Derby JARs - they're mounted via volume at /opt/jars
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
ENV PYTHONPATH="/opt:${PYTHONPATH}"

USER airflow

RUN pip install --no-cache-dir \
    pyspark==3.5.3 \
    delta-spark==3.0.0 \
    apache-airflow-providers-apache-spark \
    faker==24.0.0